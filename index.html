<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <nav
      class="navbar bg-dark navbar-expand-lg bg-body-tertiary"
      data-bs-theme="dark"
    >
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Navbar</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">AllTransaction</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Pricing</a>
            </li>
            <li class="nav-item">
              <a class="nav-link disabled" aria-disabled="true">Disabled</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- center the below div -->
    <div id="loading-screen" style="display: none; position: fixed; z-index: 999; height: 2em; width: 2em; overflow: show; margin: auto; top: 0; left: 0; bottom: 0; right: 0;">
      <div class="spinner-border text-primary" role="status">
          <!-- <span class="sr-only">Loading...</span> -->
      </div>
  </div>

    <div class="container transaction-form">
      <form>
        <div class="mb-3">
          <label for="exampleInputEmail1" class="form-label">Amount</label>
          <input
            type="Number"
            name="amount"
            class="form-control"
            id="exampleInputEmail1"
          />
        </div>
        <div class="mb-3">
          <label for="exampleInputPassword1" class="form-label"
            >Description</label
          >
          <input
            type="text"
            name="description"
            class="form-control"
            id="exampleInputPassword1"
          />
        </div>

        <div class="mb-3">
          <label for="exampleInputPassword1" class="form-label">Category</label>
          <input
            type="text"
            name="category"
            class="form-control"
            id="exampleInputPassword1"
          />
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>

    <!-- write a js function in script tag to send the values from the from to a api endpoint when submitted -->
    <script>
      function submitForm(event) {
        event.preventDefault();

        let formData = new FormData(event.target);
        let jsonObject = {};

        for (const [key, value] of formData.entries()) {
          jsonObject[key] = value;
        }

        // Add the current date to the jsonObject
        jsonObject.date = new Date().toISOString();

        fetch(
          "https://money-management-6dvx.onrender.com/api/MoneyManagement",
          {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(jsonObject),
          }
        )
          .then((response) => {
            if (response.ok) {
              alert("Data inserted successfully");
              return response.json();
            } else {
              throw new Error("Error: " + response.status);
            }
          })
          .then((data) => console.log(data))
          .catch((error) => console.error("Error:", error));
      }

      document.querySelector("form").addEventListener("submit", submitForm);
    </script>

    <!-- // script for all transaction -->

    <script>
      document.querySelector('.navbar-nav .nav-item:nth-child(2) .nav-link').addEventListener('click', function(event) {
          event.preventDefault();
          // Remove the form
          document.querySelector('.transaction-form').remove();
          // Show the loading screen
    document.getElementById('loading-screen').style.display = 'block';

      
          fetch('https://money-management-6dvx.onrender.com/api/MoneyManagement')
          .then(response => response.json())
          .then(data => {
              
              // Hide the loading screen
        document.getElementById('loading-screen').style.display = 'none';

        if (data.length === 0) {
          alert('No transactions found.');
          location.reload();
          return;
      }
      
              // Create the container
              let container = document.createElement('div');
              container.classList.add('container', 'mt-5');
      
              // Create the table
              let table = document.createElement('table');
              table.classList.add('table', 'table-striped', 'table-hover', 'table-bordered');
      
              // Add table headers
              let thead = document.createElement('thead');
              thead.classList.add('table-dark');
              let headerRow = document.createElement('tr');
              Object.keys(data[0]).forEach(key => {
                  if (key !== 'id') {
                      let th = document.createElement('th');
                      th.textContent = key;
                      headerRow.appendChild(th);
                  }
              });
              thead.appendChild(headerRow);
              table.appendChild(thead);
      
              // Add table body
              let tbody = document.createElement('tbody');
              data.forEach(transaction => {
                  let row = document.createElement('tr');
                  Object.entries(transaction).forEach(([key, value]) => {
                      if (key !== 'id') {
                          let td = document.createElement('td');
                          if (key === 'date') {
                              let date = new Date(value);
                              value = date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear();
                          }
                          td.textContent = value;
                          row.appendChild(td);
                      }
                  });
                  tbody.appendChild(row);
              });
              table.appendChild(tbody);
      
              // Add the table to the container
              container.appendChild(table);
              // Add the container to the body
              document.body.appendChild(container);
      
              // Create the back button
              let backButton = document.createElement('button');
              backButton.textContent = 'Go back to form';
              backButton.classList.add('btn', 'btn-primary', 'mt-5');
              backButton.style.display = 'block';
              backButton.style.margin = '0 auto';
              backButton.addEventListener('click', function() {
                  location.reload();
              });
      
              // Add the back button to the body
              document.body.appendChild(backButton);
          })
          .catch((error) => console.error('Error:', error));
      });
      </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
      integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
